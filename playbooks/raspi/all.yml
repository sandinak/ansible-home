- name: pre configure hosts
  hosts: all
  gather_facts: no
  pre_tasks:
    - block: 
        - name: test ssh
          delegate_to: localhost
          shell: ssh 
            - o StrictHostKeyChecking=no
            pi@{{ansible_host}} 

      rescue: 
        - name: set password to default and try again
          set_fact:
            ansible_ssh_pass: "{{raspi_default_password}}" 
          when: raspi_default_password is defined
         
        # - ping: 
         
    - name: push key from ~/.ssh/id_rsa.pub
      authorized_key:
        state: present
        user: pi
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"

- name: configure raspis
  hosts: raspi
  gather_facts: yes
  roles:
    - raspi/config
    - raspi/iw_config

- import_playbook: pool.yml
- import_playbook: webcam.yml
- import_playbook: audio.yml
